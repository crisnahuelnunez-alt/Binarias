<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Riesgo Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- Variables de Color y Estilos Base --- */
        :root {
            --color-background-start: #1a1a2e; /* Azul oscuro */
            --color-background-mid: #16213e;   /* Azul medio */
            --color-background-end: #0f3460;   /* Azul petróleo */
            --color-primary: #00d4ff;         /* Cian vibrante */
            --color-secondary: #00ff88;       /* Verde esmeralda */
            --color-tertiary: #a0a0a0;        /* Gris para texto mutado */
            --color-text-light: #e0e0e0;       /* Texto claro */
            --color-text-dark: #333;           /* Texto oscuro para botones */
            --color-card-background: rgba(22, 33, 62, 0.75); /* Fondo de tarjeta semitransparente */
            --color-card-border: rgba(255, 255, 255, 0.15); /* Borde de tarjeta sutil */
            --color-input-background: rgba(0, 0, 0, 0.3); /* Fondo de input oscuro */
            --color-win: #28a745;             /* Verde para ganancia */
            --color-loss: #dc3545;            /* Rojo para pérdida */
            --color-warning: #ffc107;         /* Amarillo para advertencias */
            --border-radius-main: 15px;       /* Radio de borde principal */
            --border-radius-sm: 8px;          /* Radio de borde pequeño */
            --font-family-main: 'Poppins', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-main);
            background: linear-gradient(135deg, var(--color-background-start), var(--color-background-mid), var(--color-background-end));
            color: var(--color-text-light);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center; /* Centrar verticalmente */
            font-size: 16px;
            line-height: 1.6;
            padding: 30px;
        }

        .hidden { display: none !important; }

        /* --- Pantalla de Bienvenida --- */
        #welcome-screen {
            text-align: center;
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }

        #welcome-screen h1 {
            font-size: 3.5em;
            font-weight: 800;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            margin-bottom: 10px;
        }

        #welcome-screen p {
            font-size: 1.5em;
            color: var(--color-tertiary);
            margin-bottom: 40px;
            font-weight: 300;
        }
        
        #welcome-screen .input-group {
             margin-bottom: 20px;
        }

        #welcome-screen input {
            padding: 20px;
            font-size: 1.2em;
            text-align: center;
        }

        #welcome-screen .risk-warning-welcome {
            background: rgba(220, 53, 69, 0.15);
            border: 1px solid var(--color-loss);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            margin-top: 30px;
            color: var(--color-loss);
            font-size: 0.9em;
            line-height: 1.5;
        }

        /* --- Contenedor Principal Dashboard --- */
        .container {
            max-width: 960px;
            width: 100%;
            margin: 0 auto;
        }

        /* --- Cabecera --- */
        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header h1 {
            font-size: 3.2em;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1.5px;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            color: var(--color-tertiary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* --- Tarjetas (Cards) --- */
        .card {
            background: var(--color-card-background);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--color-card-border);
            border-radius: var(--border-radius-main);
            padding: 35px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
        }

        .card h2 {
            margin-bottom: 30px;
            color: var(--color-primary);
            font-size: 1.8em;
            font-weight: 700;
            border-bottom: 1px solid var(--color-card-border);
            padding-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .card h2 .icon {
            font-size: 1.2em;
            color: var(--color-secondary);
        }

        /* --- Formularios y Campos de Entrada --- */
        .input-group {
            margin-bottom: 25px;
            width: 100%;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--color-tertiary);
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 16px;
            border: 1px solid transparent;
            border-radius: var(--border-radius-sm);
            background: var(--color-input-background);
            color: var(--color-text-light);
            font-size: 1.05em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 18px rgba(0, 212, 255, 0.3);
            background: rgba(0, 0, 0, 0.4);
        }
        
        .split-inputs {
            display: flex;
            gap: 25px;
            flex-wrap: wrap; /* Permite que los inputs se envuelvan en pantallas pequeñas */
        }
        .split-inputs .input-group {
            flex: 1; /* Hace que los inputs ocupen el espacio disponible */
            min-width: 280px; /* Asegura que no se hagan demasiado pequeños */
        }

        /* --- Botones --- */
        .btn, .btn-primary {
            color: var(--color-text-dark);
            border: none;
            padding: 18px 35px;
            border-radius: var(--border-radius-sm);
            font-size: 1.15em;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            box-shadow: 0 6px 25px rgba(0, 230, 172, 0.25);
        }
        .btn-primary:hover {
            box-shadow: 0 10px 30px rgba(0, 230, 172, 0.4);
        }
        .btn:hover, .btn-primary:hover {
            transform: translateY(-5px) scale(1.01);
            opacity: 0.98;
        }
        
        .btn-win { background-color: var(--color-win); color: white; }
        .btn-loss { background-color: var(--color-loss); color: white; }
        .btn-reset { background: #6c757d; color: white; }

        /* --- Panel en Vivo y Mensajes --- */
        .live-panel { text-align: center; }
        .live-panel h3 {
            font-size: 1.2em;
            color: var(--color-tertiary);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        .investment-amount {
            font-size: 4.5em;
            font-weight: 800;
            background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            line-height: 1.2;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }
        
        .action-buttons { display: flex; gap: 20px; margin-top: 20px; }
        .action-buttons .btn { margin-top: 0; }
        
        #session-end-message {
            font-size: 2.5em; font-weight: 700; padding: 50px 30px;
            border-radius: var(--border-radius-main); text-align: center;
            letter-spacing: 0.8px; margin-top: 20px;
        }
        .victory-message {
            color: var(--color-secondary); background: rgba(0, 255, 136, 0.15);
            border: 1px solid var(--color-secondary);
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
        }
        .loss-message {
            color: var(--color-loss); background: rgba(220, 53, 69, 0.15);
            border: 1px solid var(--color-loss);
            text-shadow: 0 0 15px rgba(220, 53, 69, 0.6);
        }

        /* --- Tabla de Historial --- */
        table {
            width: 100%; border-collapse: collapse; background: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius-main); overflow: hidden;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
        }
        th, td {
            padding: 18px; text-align: center;
            border-bottom: 1px solid var(--color-card-border);
        }
        tr:last-child td { border-bottom: none; }
        th {
            background: rgba(0, 0, 0, 0.3); color: var(--color-primary);
            font-weight: 700; font-size: 1em;
            text-transform: uppercase; letter-spacing: 0.8px;
        }
        .win-row { background: rgba(0, 255, 136, 0.1); }
        .loss-row { background: rgba(255, 0, 68, 0.1); }

        /* --- Media Queries --- */
        @media (max-width: 768px) {
            #welcome-screen h1 { font-size: 2.8em; }
            #welcome-screen p { font-size: 1.2em; }
            .header h1 { font-size: 2.5em; }
            .split-inputs { flex-direction: column; gap: 0; }
            .investment-amount { font-size: 3.5em; }
            .action-buttons { flex-direction: column; gap: 15px; }
        }
    </style>
</head>
<body>
    <div id="welcome-screen">
        <h1>Gestión de Riesgo Pro</h1>
        <p>Dominando Binarias</p>
        <div class="input-group">
            <label for="initial-balance">¿Cuál es tu capital para la sesión de hoy?</label>
            <input type="number" id="initial-balance" value="100" min="1">
        </div>
        <button class="btn-primary" id="start-session-btn">Iniciar Sesión</button>
        <div class="risk-warning-welcome">
            ⚠️ <strong>Peligro:</strong> El trading de opciones binarias es de alto riesgo. Opera solo con dinero que estés dispuesto a perder.
        </div>
    </div>

    <div id="dashboard" class="container hidden">
        <div class="header">
            <h1>Asistente de Inversión Estratégica</h1>
            <p>Planifica tus operaciones con disciplina y gestión de riesgo.</p>
        </div>

        <div id="setup-card" class="card">
            <h2><span class="icon">⚙️</span> Plan de Sesión</h2>
            
            <div class="input-group">
                <label for="strategy">Estrategia de Gestión de Riesgo</label>
                <select id="strategy">
                    <option value="kelly">Criterio de Kelly (Recomendado)</option>
                    <option value="martingale">Martingala (Recuperación Agresiva)</option>
                </select>
            </div>

            <div class="split-inputs">
                <div class="input-group">
                    <label for="balance">Balance de Sesión ($)</label>
                    <input type="number" id="balance" value="100" min="1" readonly>
                </div>
                <div class="input-group">
                    <label for="minInvestment">Inversión Mínima ($)</label>
                    <input type="number" id="minInvestment" value="1" step="0.01" min="0.01">
                </div>
            </div>
            <div class="split-inputs">
                <div class="input-group">
                    <label for="payoutRate">Payout / Retorno del Broker (%)</label>
                    <input type="number" id="payoutRate" value="87" step="0.1">
                </div>
                <div class="input-group" id="historicalWinRate-group">
                    <label for="historicalWinRate">Tasa de Aciertos Histórica (%)</label>
                    <input type="number" id="historicalWinRate" value="60" step="0.1">
                </div>
            </div>
            <div class="split-inputs">
                <div class="input-group">
                    <label for="sessionProfitGoal">Take Profit / Meta de Ganancia (%)</label>
                    <input type="number" id="sessionProfitGoal" value="20" min="1">
                </div>
                <div class="input-group">
                    <label for="stopLossPercent">Stop-Loss / Límite de Pérdida (%)</label>
                    <input type="number" id="stopLossPercent" value="25" min="1">
                </div>
            </div>
            
            <div id="martingale-fields" class="hidden">
                <div class="split-inputs">
                    <div class="input-group">
                        <label for="winsNeeded">Operaciones a Ganar (Martingala)</label>
                        <input type="number" id="winsNeeded" value="4" min="1">
                    </div>
                    <div class="input-group">
                        <label for="totalOps">Máximo de Operaciones (Martingala)</label>
                        <input type="number" id="totalOps" value="15" min="1">
                    </div>
                </div>
            </div>
            <button class="btn-primary" id="startBtn">▶️ Comenzar Operativa</button>
        </div>

        <div id="live-card" class="card hidden">
            <h2><span class="icon">🔴</span> Panel de Operación en Vivo</h2>
            <div id="live-panel-content" class="live-panel">
                <h3 id="operation-label"></h3>
                <div id="investment-amount" class="investment-amount"></div>
                <div class="action-buttons">
                    <button class="btn btn-win" id="winBtn">Gané ✅</button>
                    <button class="btn btn-loss" id="lossBtn">Perdí ❌</button>
                </div>
            </div>
            <div id="session-end-message" class="hidden"></div>
            <button class="btn btn-reset" id="resetBtn">Terminar y Reiniciar Sesión</button>
        </div>

        <div id="history-card" class="card hidden">
            <h2><span class="icon">📋</span> Historial de Operaciones</h2>
            <div id="tableContent"></div>
        </div>
    </div>

    <script>
        // --- ESTADO GLOBAL DE LA APLICACIÓN ---
        const state = {
            strategy: 'kelly', historicalWinRate: 0, payoutRate: 0,
            initialBalance: 0, totalOps: 0, winsNeeded: 0, minInvestment: 1,
            sessionProfitGoal: 20, stopLossPercent: 25, stopLossTriggerAmount: 0,
            takeProfitTriggerAmount: 0, profitPerWin: 0, currentBalance: 0, 
            lossesToRecover: 0, operationNumber: 1, winCount: 0, lastInvestment: 0,
            history: []
        };

        // --- MANEJO DE LA INTERFAZ DE USUARIO (UI) ---
        const ui = {
            elements: {
                welcomeScreen: document.getElementById('welcome-screen'),
                dashboard: document.getElementById('dashboard'),
                startSessionBtn: document.getElementById('start-session-btn'),
                initialBalanceInput: document.getElementById('initial-balance'),
                balanceInput: document.getElementById('balance'),
                setupCard: document.getElementById('setup-card'),
                liveCard: document.getElementById('live-card'),
                historyCard: document.getElementById('history-card'),
                operationLabel: document.getElementById('operation-label'),
                investmentAmount: document.getElementById('investment-amount'),
                livePanelContent: document.getElementById('live-panel-content'),
                sessionEndMessage: document.getElementById('session-end-message'),
                tableContent: document.getElementById('tableContent'),
                strategySelect: document.getElementById('strategy'),
                martingaleFields: document.getElementById('martingale-fields'),
                winRateGroup: document.getElementById('historicalWinRate-group'),
                startBtn: document.getElementById('startBtn'),
                winBtn: document.getElementById('winBtn'),
                lossBtn: document.getElementById('lossBtn'),
                resetBtn: document.getElementById('resetBtn')
            },
            showDashboard() {
                this.elements.welcomeScreen.classList.add('hidden');
                this.elements.dashboard.classList.remove('hidden');
                document.body.style.alignItems = 'flex-start'; // Alinea el dashboard arriba
            },
            showWelcomeScreen() {
                this.elements.dashboard.classList.add('hidden');
                this.elements.welcomeScreen.classList.remove('hidden');
                this.elements.liveCard.classList.add('hidden');
                this.elements.historyCard.classList.add('hidden');
                this.elements.setupCard.classList.remove('hidden');
                 this.elements.livePanelContent.classList.remove('hidden');
                this.elements.sessionEndMessage.classList.add('hidden');
                document.body.style.alignItems = 'center'; // Centra el welcome
            },
            updateLivePanel(opNum, totalOps, amountText) {
                const opLabel = state.strategy === 'martingale' ? `OPERACIÓN #${opNum} de ${totalOps}` : `OPERACIÓN #${opNum}`;
                this.elements.operationLabel.innerText = opLabel;
                this.elements.investmentAmount.innerText = amountText;
            },
            showEndMessage(isVictory, message) {
                this.elements.livePanelContent.classList.add('hidden');
                const msgDiv = this.elements.sessionEndMessage;
                msgDiv.innerText = message;
                msgDiv.className = isVictory ? 'victory-message' : 'loss-message';
                msgDiv.classList.remove('hidden');
            },
            renderHistoryTable(history) {
                let tableHTML = `<table><thead><tr><th>Op#</th><th>Invertiste</th><th>Resultado</th><th>Ganancia/Pérdida</th><th>Balance Final</th></tr></thead><tbody>`;
                history.forEach(op => {
                    const rowClass = op.result === 'WIN' ? 'win-row' : 'loss-row';
                    const resultColor = op.netResult >= 0 ? 'var(--color-secondary)' : 'var(--color-loss)';
                    tableHTML += `<tr class="${rowClass}">
                        <td>${op.op}</td><td>$${op.investment.toFixed(2)}</td>
                        <td>${op.result}</td><td style="color: ${resultColor}">$${op.netResult.toFixed(2)}</td>
                        <td>$${op.balance.toFixed(2)}</td></tr>`;
                });
                tableHTML += '</tbody></table>';
                this.elements.tableContent.innerHTML = tableHTML;
            },
            showLiveMode() {
                this.elements.setupCard.classList.add('hidden');
                this.elements.liveCard.classList.remove('hidden');
                this.elements.historyCard.classList.remove('hidden');
            }
        };

        // --- LÓGICA DE LA APLICACIÓN ---
        const sessionManager = {
            start() {
                try {
                    state.strategy = ui.elements.strategySelect.value;
                    state.initialBalance = parseFloat(ui.elements.balanceInput.value);
                    state.sessionProfitGoal = parseFloat(document.getElementById('sessionProfitGoal').value);
                    state.stopLossPercent = parseFloat(document.getElementById('stopLossPercent').value);
                    state.payoutRate = parseFloat(document.getElementById('payoutRate').value) / 100;
                    state.historicalWinRate = parseFloat(document.getElementById('historicalWinRate').value) / 100;
                    state.totalOps = parseInt(document.getElementById('totalOps').value);
                    state.winsNeeded = parseInt(document.getElementById('winsNeeded').value);
                    state.minInvestment = parseFloat(document.getElementById('minInvestment').value);
                } catch (e) {
                    alert('Error en la configuración: ' + e.message); return;
                }

                state.currentBalance = state.initialBalance;
                state.stopLossTriggerAmount = state.initialBalance * (1 - (state.stopLossPercent / 100));
                state.takeProfitTriggerAmount = state.initialBalance * (1 + (state.sessionProfitGoal / 100));
                state.operationNumber = 1;
                state.winCount = 0;
                state.lossesToRecover = 0;
                state.history = [];

                if (state.strategy === 'martingale') {
                    const sessionTargetProfit = state.initialBalance * (state.sessionProfitGoal / 100);
                    state.profitPerWin = sessionTargetProfit / state.winsNeeded;
                }
                
                ui.showLiveMode();
                this.calculateNextInvestment();
            },
            calculateKellyInvestment() {
                const W = state.historicalWinRate; const R = state.payoutRate;
                if (R <= 0) return state.minInvestment;
                const kellyFraction = W - ((1 - W) / R);
                if (kellyFraction <= 0) return state.minInvestment;
                const investment = state.currentBalance * kellyFraction;
                return Math.max(investment, state.minInvestment);
            },
            calculateMartingaleInvestment() {
                const calculatedInvestment = (state.lossesToRecover + state.profitPerWin) / state.payoutRate;
                return Math.max(calculatedInvestment, state.minInvestment);
            },
            calculateNextInvestment() {
                if (state.currentBalance <= 0) { this.end(false, "Capital Agotado."); return; }
                if (state.strategy === 'martingale' && state.operationNumber > state.totalOps) { this.end(false, "Límite de operaciones alcanzado."); return; }

                let finalInvestment = (state.strategy === 'kelly') ? this.calculateKellyInvestment() : this.calculateMartingaleInvestment();
                state.lastInvestment = Math.min(finalInvestment, state.currentBalance);
                ui.updateLivePanel(state.operationNumber, state.totalOps, `$${state.lastInvestment.toFixed(2)}`);
            },
            logResult(isWin) {
                const investment = state.lastInvestment;
                const netResult = isWin ? investment * state.payoutRate : -investment;
                state.currentBalance += netResult;

                state.history.push({
                    op: state.operationNumber, investment, result: isWin ? 'WIN' : 'LOSS',
                    netResult, balance: state.currentBalance
                });

                if (isWin) {
                    state.winCount++;
                    if(state.strategy === 'martingale') state.lossesToRecover = 0;
                } else {
                    if(state.strategy === 'martingale') state.lossesToRecover += investment;
                }
                
                ui.renderHistoryTable(state.history);

                if (state.currentBalance <= state.stopLossTriggerAmount) { this.end(false, "Stop-Loss alcanzado."); return; }
                if (state.currentBalance >= state.takeProfitTriggerAmount) { this.end(true, "¡Take Profit alcanzado!"); return; }
                
                state.operationNumber++;
                this.calculateNextInvestment();
            },
            end(isVictory, message) {
                ui.showEndMessage(isVictory, message);
            },
            reset() {
                ui.showWelcomeScreen();
            }
        };

        // --- INICIALIZACIÓN DE LA APP ---
        const app = {
            init() {
                // Evento para pasar de Welcome a Dashboard
                ui.elements.startSessionBtn.addEventListener('click', () => {
                    const initialBalance = ui.elements.initialBalanceInput.value;
                    if (parseFloat(initialBalance) > 0) {
                        ui.elements.balanceInput.value = initialBalance;
                        ui.showDashboard();
                    } else {
                        alert("Por favor, introduce un balance válido.");
                    }
                });

                // Eventos del Dashboard
                ui.elements.startBtn.addEventListener('click', () => sessionManager.start());
                ui.elements.winBtn.addEventListener('click', () => sessionManager.logResult(true));
                ui.elements.lossBtn.addEventListener('click', () => sessionManager.logResult(false));
                ui.elements.resetBtn.addEventListener('click', () => sessionManager.reset());

                // Lógica para mostrar/ocultar campos según la estrategia
                ui.elements.strategySelect.addEventListener('change', (e) => {
                    const isKelly = e.target.value === 'kelly';
                    ui.elements.martingaleFields.classList.toggle('hidden', isKelly);
                    ui.elements.winRateGroup.classList.toggle('hidden', !isKelly);
                });
            }
        };

        app.init();
    </script>
</body>
</html>


