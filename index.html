<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Gestión de Riesgo Pro</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>

        :root {

            --color-background-start: #1a1a2e; --color-background-mid: #16213e; --color-background-end: #0f3460;

            --color-primary: #00d4ff; --color-secondary: #00ff88; --color-tertiary: #a0a0a0;

            --color-text-light: #e0e0e0; --color-text-dark: #333; --color-card-background: rgba(22, 33, 62, 0.75);

            --color-card-border: rgba(255, 255, 255, 0.15); --color-input-background: rgba(0, 0, 0, 0.3);

            --color-win: #28a745; --color-loss: #dc3545; --color-warning: #ffc107;

            --border-radius-main: 15px; --border-radius-sm: 8px; --font-family-main: 'Poppins', sans-serif;

        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {

            font-family: var(--font-family-main);

            /* === NUEVO FONDO CON IMAGEN === */

            background-color: var(--color-background-start);

            background-image: 

                linear-gradient(135deg, var(--color-background-start) 0%, var(--color-background-mid) 50%, var(--color-background-end) 100%),

                url('assets/Gemini_Generated_Image_iogzlriogzlriogz.png');

            background-size: cover;

            background-position: center center;

            background-blend-mode: overlay; /* Mezcla el degradado con la imagen */

            /* ============================== */

            color: var(--color-text-light); 

            min-height: 100vh; 

            display: flex;

            justify-content: center; 

            align-items: center; 

            font-size: 16px;

            line-height: 1.6; 

            padding: 30px;

        }

        .hidden { display: none !important; }

        #welcome-screen { text-align: center; max-width: 600px; width: 100%; padding: 40px; }

        #welcome-screen h1 {

            font-size: 3.5em; font-weight: 800; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary));

            -webkit-background-clip: text; -webkit-text-fill-color: transparent;

            text-shadow: 0 0 15px rgba(0, 212, 255, 0.3); margin-bottom: 10px;

        }

        #welcome-screen p { font-size: 1.5em; color: var(--color-tertiary); margin-bottom: 40px; font-weight: 300; }

        .container { max-width: 960px; width: 100%; margin: 0 auto; }

        .card {

            background: var(--color-card-background); backdrop-filter: blur(15px);

            border: 1px solid var(--color-card-border);

            border-radius: var(--border-radius-main); padding: 35px;

            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4); margin-bottom: 30px;

        }

        .card h2 {

            margin-bottom: 30px; color: var(--color-primary); font-size: 1.8em; font-weight: 700;

            border-bottom: 1px solid var(--color-card-border); padding-bottom: 18px;

            display: flex; align-items: center; justify-content: space-between; gap: 12px;

        }

        .input-group { margin-bottom: 25px; width: 100%; }

        .input-group label {

            display: block; margin-bottom: 10px; font-weight: 600; color: var(--color-tertiary);

            font-size: 0.95em; text-transform: uppercase; letter-spacing: 0.5px;

        }

        .input-group input, .input-group select, .input-group textarea {

            width: 100%; padding: 16px; border: 1px solid transparent; border-radius: var(--border-radius-sm);

            background: var(--color-input-background); color: var(--color-text-light);

            font-size: 1.05em; transition: border-color 0.3s, box-shadow 0.3s; font-family: var(--font-family-main);

        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {

            outline: none; border-color: var(--color-primary);

            box-shadow: 0 0 18px rgba(0, 212, 255, 0.3);

        }

        .input-with-symbol { position: relative; }

        .input-with-symbol span { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--color-tertiary); font-size: 1.1em; font-weight: 600; pointer-events: none; }

        .input-with-symbol input { padding-left: 40px !important; }

        .split-inputs { display: flex; gap: 25px; flex-wrap: wrap; }

        .split-inputs .input-group { flex: 1; min-width: 280px; }

        .btn, .btn-primary, .btn-secondary {

            color: var(--color-text-dark); border: none; padding: 18px 35px; border-radius: var(--border-radius-sm);

            font-size: 1.15em; font-weight: 700; cursor: pointer; width: 100%; margin-top: 15px;

            text-transform: uppercase; letter-spacing: 0.8px;

        }

        .btn-primary { background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); }

        .btn-secondary { background: #6c757d; color: white; font-size: 0.8em; padding: 8px 15px; width: auto; margin-top: 0; }

        .btn-win { background-color: var(--color-win); color: white; }

        .btn-loss { background-color: var(--color-loss); color: white; }

        .investment-amount { font-size: 4.5em; font-weight: 800; background: linear-gradient(45deg, var(--color-primary), var(--color-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 30px; line-height: 1.2; text-shadow: 0 0 20px rgba(0, 212, 255, 0.5); text-align: center; }

        .action-buttons { display: flex; gap: 20px; margin-top: 20px; }

        #phase-display { font-size: 1em; color: var(--color-warning); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }

        table { width: 100%; border-collapse: collapse; background: rgba(0, 0, 0, 0.2); border-radius: var(--border-radius-main); overflow: hidden; }

        th, td { padding: 18px; text-align: center; border-bottom: 1px solid var(--color-card-border); }

        th { background: rgba(0, 0, 0, 0.3); color: var(--color-primary); font-weight: 700; }

        .win-row { background: rgba(0, 255, 136, 0.1); }

        .loss-row { background: rgba(255, 0, 68, 0.1); }

        @media (max-width: 768px) {

            .investment-amount { font-size: 5em; }

            .action-buttons { flex-direction: column; }

            .action-buttons .btn { width: 100%; padding: 20px; font-size: 1.2em; }

        }

    </style>

</head>

<body>

    <div id="welcome-screen">

        <h1>Gestión de Riesgo Pro</h1>

        <p>Dominando Binarias</p>

        <div class="input-group">

            <label for="initial-balance">¿Cuál es tu capital para la sesión?</label>

            <div class="input-with-symbol">

                <span>$</span>

                <input type="number" id="initial-balance" value="100" min="1">

            </div>

        </div>

        <button class="btn-primary" id="start-session-btn">Iniciar Sesión</button>

    </div>



    <div id="dashboard" class="container hidden">

        <div id="setup-card" class="card">

            <h2><span class="icon">⚙️</span> Plan de Sesión</h2>

            <div class="input-group">

                <label for="strategy">Estrategia de Gestión de Riesgo</label>

                <select id="strategy">

                    <option value="kelly">Criterio de Kelly (Óptimo)</option>

                    <option value="martingale">Martingala (Recuperación)</option>

                    <option value="phases_system">Sistema de Fases (Ataque)</option>

                </select>

            </div>

            <div id="strategy-info-box" style="margin-bottom: 25px; padding: 15px; border-left: 4px solid; border-radius: 8px; font-size: 0.9em; line-height: 1.5;"></div>

            

            <div id="phases-system-group" class="hidden">

                 <div class="split-inputs">

                    <div class="input-group">

                        <label for="base-investment-percent">Inversión Base (%)</label>

                        <input type="number" id="base-investment-percent" value="5" min="1">

                    </div>

                    <div class="input-group">

                        <label for="max-ops">Operaciones Máximas</label>

                        <input type="number" id="max-ops" value="10" min="2">

                    </div>

                 </div>

            </div>



            <div class="split-inputs">

                <div class="input-group">

                    <label for="balance">Balance de Sesión</label>

                    <div class="input-with-symbol">

                        <span>$</span>

                        <input type="number" id="balance" value="100" min="1" readonly>

                    </div>

                </div>

                <div class="input-group">

                    <label for="minInvestment">Inversión Mínima</label>

                    <div class="input-with-symbol">

                        <span>$</span>

                        <input type="number" id="minInvestment" value="1" step="0.01" min="0.01">

                    </div>

                </div>

            </div>

            <div class="split-inputs">

                <div class="input-group">

                    <label for="payoutRate">Payout del Broker (%)</label>

                    <input type="number" id="payoutRate" value="87" step="0.1">

                </div>

                <div class="input-group" id="historicalWinRate-group">

                    <label for="historicalWinRate">Tasa de Aciertos (%)</label>

                    <input type="number" id="historicalWinRate" value="60" step="0.1">

                </div>

            </div>

            <div id="standard-params-group">

                <div class="split-inputs">

                    <div class="input-group">

                        <label for="sessionProfitGoal">Take Profit (%)</label>

                        <input type="number" id="sessionProfitGoal" value="20" min="1">

                    </div>

                    <div class="input-group">

                        <label for="stopLossPercent">Stop-Loss (%)</label>

                        <input type="number" id="stopLossPercent" value="25" min="1">

                    </div>

                </div>

            </div>

            <button class="btn-primary" id="startBtn">▶️ Comenzar Operativa</button>

        </div>

        <div id="live-card" class="card hidden">

            <h2>

                <span><span class="icon">🔴</span> Panel de Operación</span>

                <button id="back-to-setup-btn" class="btn-secondary">⬅️ Volver a Configurar</button>

            </h2>

            <div id="live-panel-content" style="text-align: center;">

                <h3 id="operation-label"></h3>

                <div id="phase-display"></div>

                <div id="investment-amount" class="investment-amount"></div>

                <div class="action-buttons">

                    <button class="btn btn-win" id="winBtn">Gané ✅</button>

                    <button class="btn btn-loss" id="lossBtn">Perdí ❌</button>

                </div>

            </div>

        </div>

        <div id="history-card" class="card hidden">

            <h2><span class="icon">📋</span> Historial de la Sesión</h2>

            <div id="tableContent"></div>

        </div>

        <div id="journal-card" class="card hidden">

            <h2><span class="icon">✍️</span> Análisis de la Sesión</h2>

            <div id="journal-summary" style="margin-bottom: 25px;"></div>

            <div class="input-group">

                <label for="journal-notes">Mis Notas de la Sesión</label>

                <textarea id="journal-notes" rows="4" placeholder="¿Qué aprendiste hoy? ¿Seguiste tu plan al 100%?"></textarea>

            </div>

            <button class="btn-primary" id="save-session-btn">Guardar Sesión y Volver al Inicio</button>

        </div>

    </div>



    <script>

        const state = {

            strategy: 'kelly', maxOps: 10, baseInvestmentPercent: 5, currentPhase: 'acumulacion',

            historicalWinRate: 0, payoutRate: 0, initialBalance: 0, minInvestment: 1, 

            sessionProfitGoal: 20, stopLossPercent: 25, stopLossTriggerAmount: 0, 

            takeProfitTriggerAmount: 0, currentBalance: 0, operationNumber: 1, winCount: 0, 

            lastInvestment: 0, history: [], lossesToRecover: 0

        };

        const ui = {

            elements: {

                welcomeScreen: document.getElementById('welcome-screen'), dashboard: document.getElementById('dashboard'),

                startSessionBtn: document.getElementById('start-session-btn'), initialBalanceInput: document.getElementById('initial-balance'),

                balanceInput: document.getElementById('balance'), setupCard: document.getElementById('setup-card'),

                liveCard: document.getElementById('live-card'), historyCard: document.getElementById('history-card'),

                operationLabel: document.getElementById('operation-label'), investmentAmount: document.getElementById('investment-amount'),

                tableContent: document.getElementById('tableContent'), strategySelect: document.getElementById('strategy'),

                strategyInfoBox: document.getElementById('strategy-info-box'),

                phasesSystemGroup: document.getElementById('phases-system-group'),

                winRateGroup: document.getElementById('historicalWinRate-group'),

                standardParamsGroup: document.getElementById('standard-params-group'),

                startBtn: document.getElementById('startBtn'), winBtn: document.getElementById('winBtn'),

                lossBtn: document.getElementById('lossBtn'),

                journalCard: document.getElementById('journal-card'), journalSummary: document.getElementById('journal-summary'),

                journalNotes: document.getElementById('journal-notes'),

                saveSessionBtn: document.getElementById('save-session-btn'),

                backToSetupBtn: document.getElementById('back-to-setup-btn'),

                phaseDisplay: document.getElementById('phase-display')

            },

            showDashboard() { this.elements.welcomeScreen.classList.add('hidden'); this.elements.dashboard.classList.remove('hidden'); document.body.style.alignItems = 'flex-start'; },

            showWelcomeScreen() {

                this.elements.dashboard.classList.add('hidden');

                this.elements.welcomeScreen.classList.remove('hidden');

                document.body.style.alignItems = 'center';

            },

            showSetup() {

                this.elements.liveCard.classList.add('hidden');

                this.elements.historyCard.classList.add('hidden');

                this.elements.journalCard.classList.add('hidden');

                this.elements.setupCard.classList.remove('hidden');

            },

            updateLivePanel(opNum, totalOps, amountText) {

                this.elements.operationLabel.innerText = `OPERACIÓN #${opNum} de ${totalOps}`;

                this.elements.investmentAmount.innerText = amountText;

                if(state.strategy === 'phases_system') {

                    this.elements.phaseDisplay.innerText = `FASE: ${state.currentPhase.toUpperCase()}`;

                    this.elements.phaseDisplay.style.color = state.currentPhase === 'ataque' ? 'var(--color-secondary)' : 'var(--color-warning)';

                } else {

                    this.elements.phaseDisplay.innerText = '';

                }

            },

            renderHistoryTable(history) {

                let tableHTML = `<table><thead><tr><th>Op#</th><th>Invertido</th><th>Resultado</th><th>G/P</th><th>Balance</th></tr></thead><tbody>`;

                history.forEach(op => {

                    const rowClass = op.result === 'WIN' ? 'win-row' : 'loss-row';

                    const resultColor = op.netResult >= 0 ? 'var(--color-secondary)' : 'var(--color-loss)';

                    tableHTML += `<tr class="${rowClass}"><td>${op.op}</td><td>$${op.investment.toFixed(2)}</td><td>${op.result}</td><td style="color: ${resultColor}">$${op.netResult.toFixed(2)}</td><td>$${op.balance.toFixed(2)}</td></tr>`;

                });

                this.elements.tableContent.innerHTML = tableHTML + '</tbody></table>';

            },

            showLiveMode() { this.elements.setupCard.classList.add('hidden'); this.elements.liveCard.classList.remove('hidden'); this.elements.historyCard.classList.remove('hidden'); },

            updateStrategyInfo(strategy) {

                let info = {}; const infoBox = this.elements.strategyInfoBox;

                switch (strategy) {

                    case 'kelly': info = { borderColor: 'var(--color-primary)', title: '<strong>Riesgo:</strong> Moderado', description: '<strong>Ideal para:</strong> Crecimiento óptimo y a largo plazo.', warning: '<strong>Advertencia:</strong> Requiere conocer tu tasa de aciertos real.' }; break;

                    case 'martingale': info = { borderColor: 'var(--color-warning)', title: '<strong>Riesgo:</strong> Alto', description: '<strong>Ideal para:</strong> Recuperación de pérdidas pequeñas.', warning: '<strong>Advertencia:</strong> Peligroso en rachas de pérdidas.' }; break;

                    case 'phases_system': info = { borderColor: 'var(--color-loss)', title: '<strong>Riesgo:</strong> Alto y Estratégico', description: '<strong>Ideal para:</strong> Arriesgar ganancias para un crecimiento exponencial.', warning: '<strong>Advertencia:</strong> Requiere disciplina para volver a la fase de acumulación.' }; break;

                }

                infoBox.style.borderColor = info.borderColor; infoBox.innerHTML = `<p>${info.title}</p><p>${info.description}</p><p style="opacity: 0.8;">${info.warning}</p>`;

            }

        };

        const sessionManager = {

            start() {

                try {

                    state.strategy = ui.elements.strategySelect.value;

                    state.initialBalance = parseFloat(ui.elements.balanceInput.value);

                    state.minInvestment = parseFloat(document.getElementById('minInvestment').value);

                    state.payoutRate = parseFloat(document.getElementById('payoutRate').value) / 100;

                    if (state.strategy === 'kelly') { state.historicalWinRate = parseFloat(document.getElementById('historicalWinRate').value) / 100; }

                    if (state.strategy === 'phases_system') { 

                        state.baseInvestmentPercent = parseFloat(document.getElementById('base-investment-percent').value);

                        state.maxOps = parseInt(document.getElementById('max-ops').value);

                        state.currentPhase = 'acumulacion';

                    } else {

                        state.sessionProfitGoal = parseFloat(document.getElementById('sessionProfitGoal').value);

                        state.stopLossPercent = parseFloat(document.getElementById('stopLossPercent').value);

                        state.stopLossTriggerAmount = state.initialBalance * (1 - (state.stopLossPercent / 100));

                        state.takeProfitTriggerAmount = state.initialBalance * (1 + (state.sessionProfitGoal / 100));

                    }

                } catch (e) { alert('Error en la configuración: ' + e.message); return; }

                state.currentBalance = state.initialBalance; state.operationNumber = 1; state.winCount = 0;

                state.history = []; state.lossesToRecover = 0;

                ui.showLiveMode(); this.calculateNextInvestment();

            },

            calculateKellyInvestment() { const W = state.historicalWinRate; const R = state.payoutRate; if (R <= 0) return state.minInvestment; const kellyFraction = W - ((1 - W) / R); if (kellyFraction <= 0) return state.minInvestment; const investment = state.currentBalance * kellyFraction; return Math.max(investment, state.minInvestment); },

            calculateMartingaleInvestment() { 

                const targetWinProfit = state.initialBalance * 0.02; 

                const calculatedInvestment = (state.lossesToRecover + targetWinProfit) / state.payoutRate;

                return Math.max(calculatedInvestment, state.minInvestment);

            },

            calculatePhasesSystemInvestment() {

                let investment = 0;

                if(state.currentPhase === 'acumulacion') {

                    investment = state.initialBalance * (state.baseInvestmentPercent / 100);

                } else { 

                    const profit = state.currentBalance - state.initialBalance;

                    investment = profit > state.minInvestment ? profit : state.minInvestment;

                }

                return Math.max(investment, state.minInvestment);

            },

            calculateNextInvestment() {

                let finalInvestment = 0;

                let totalOps = (state.strategy === 'phases_system') ? state.maxOps : '∞';

                if (state.strategy === 'kelly') { finalInvestment = this.calculateKellyInvestment(); }

                else if (state.strategy === 'martingale') { finalInvestment = this.calculateMartingaleInvestment(); }

                else if (state.strategy === 'phases_system') { finalInvestment = this.calculatePhasesSystemInvestment(); }

                state.lastInvestment = Math.min(finalInvestment, state.currentBalance);

                ui.updateLivePanel(state.operationNumber, totalOps, `$${state.lastInvestment.toFixed(2)}`);

            },

            logResult(isWin) {

                const investment = state.lastInvestment;

                if (investment > state.currentBalance) { this.end(false); return; }

                const netResult = isWin ? investment * state.payoutRate : -investment;

                state.currentBalance += netResult;

                if (isWin) { state.winCount++; }

                state.history.push({ op: state.operationNumber, investment, result: isWin ? 'WIN' : 'LOSS', netResult, balance: state.currentBalance });

                

                if(state.strategy === 'phases_system') {

                    if(state.currentPhase === 'acumulacion' && state.currentBalance > state.initialBalance) { state.currentPhase = 'ataque'; } 

                    else if (state.currentPhase === 'ataque' && !isWin) { state.currentPhase = 'acumulacion'; }

                }

                if (!isWin && state.strategy === 'martingale') { state.lossesToRecover += investment; } 

                else if (isWin && state.strategy === 'martingale') { state.lossesToRecover = 0; }

                

                ui.renderHistoryTable(state.history);

                

                let isSessionOver = false;

                if(state.strategy === 'phases_system') {

                    isSessionOver = (state.operationNumber >= state.maxOps) || (state.currentBalance < state.minInvestment);

                } else {

                    isSessionOver = (state.currentBalance <= state.stopLossTriggerAmount || state.currentBalance >= state.takeProfitTriggerAmount) || (state.currentBalance < state.minInvestment);

                }

                

                if (isSessionOver) {

                    this.end(state.currentBalance > state.initialBalance);

                } else {

                    state.operationNumber++; this.calculateNextInvestment();

                }

            },

            end(isVictory) {

                ui.elements.liveCard.classList.add('hidden'); ui.elements.historyCard.classList.add('hidden');

                const profitLoss = state.currentBalance - state.initialBalance;

                const profitLossPercent = (state.initialBalance > 0) ? (profitLoss / state.initialBalance) * 100 : 0;

                const totalOps = state.history.length;

                const winCount = state.history.filter(op => op.result === 'WIN').length;

                const winRate = totalOps > 0 ? (winCount / totalOps) * 100 : 0;

                const resultText = isVictory ? 'Sesión en Ganancia' : 'Sesión en Pérdida';

                const resultColor = isVictory ? 'var(--color-win)' : 'var(--color-loss)';

                ui.elements.journalSummary.innerHTML = `<p style="font-size: 1.4em;"><strong>Resultado:</strong> <span style="color: ${resultColor};">${resultText}</span></p><p>Balance Final: $${state.currentBalance.toFixed(2)} ($${profitLoss.toFixed(2)})</p><p><strong>Operaciones Totales:</strong> ${totalOps}</p><p><strong>Tasa de Aciertos:</strong> ${winRate.toFixed(1)}% (${winCount}G / ${totalOps - winCount}P)</p>`;

                ui.elements.journalCard.classList.remove('hidden');

            },

            saveSessionAndReset() {

                let allSessions = JSON.parse(localStorage.getItem('tradingSessions')) || [];

                const sessionData = { date: new Date().toISOString(), initialBalance: state.initialBalance, finalBalance: state.currentBalance, strategy: state.strategy, notes: ui.elements.journalNotes.value, history: state.history };

                allSessions.push(sessionData);

                localStorage.setItem('tradingSessions', JSON.stringify(allSessions));

                this.reset();

            },

            reset() {

                ui.elements.journalNotes.value = '';

                ui.elements.journalCard.classList.add('hidden');

                ui.elements.liveCard.classList.add('hidden');

                ui.elements.historyCard.classList.add('hidden');

                ui.elements.setupCard.classList.remove('hidden');

                ui.showWelcomeScreen();

            },

            goBackToSetup() { ui.showSetup(); }

        };

        const app = {

            init() {

                ui.elements.startSessionBtn.addEventListener('click', () => {

                    const initialBalance = ui.elements.initialBalanceInput.value;

                    if (parseFloat(initialBalance) > 0) { ui.elements.balanceInput.value = initialBalance; ui.showDashboard(); } else { alert("Por favor, introduce un balance válido."); }

                });

                ui.elements.startBtn.addEventListener('click', () => sessionManager.start());

                ui.elements.winBtn.addEventListener('click', () => sessionManager.logResult(true));

                ui.elements.lossBtn.addEventListener('click', () => sessionManager.logResult(false));

                ui.elements.saveSessionBtn.addEventListener('click', () => sessionManager.saveSessionAndReset());

                ui.elements.backToSetupBtn.addEventListener('click', () => sessionManager.goBackToSetup());

                ui.elements.strategySelect.addEventListener('change', (e) => {

                    const strategy = e.target.value;

                    ui.elements.phasesSystemGroup.classList.toggle('hidden', strategy !== 'phases_system');

                    ui.elements.winRateGroup.classList.toggle('hidden', strategy !== 'kelly');

                    ui.elements.standardParamsGroup.classList.toggle('hidden', strategy === 'phases_system');

                    ui.updateStrategyInfo(strategy);

                });

                ui.updateStrategyInfo('kelly');

            }

        };

        app.init();

    </script>

</body>

</html>
